{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "project_list.schema.json",
  "title": "Project List Schema",
  "description": "Universal project tracking schema supporting multiple work types: features, research, planning, knowledge, and investigation",
  "type": "object",
  "required": ["project", "items"],
  "properties": {
    "project": {
      "type": "string",
      "description": "Unique project identifier (directory name under projects/)"
    },
    "type": {
      "type": "string",
      "enum": ["feature", "research", "planning", "knowledge", "investigation"],
      "default": "feature",
      "description": "Project type determines item schema and lifecycle"
    },
    "description": {
      "type": "string",
      "description": "Human-readable project description"
    },
    "created": {
      "type": "string",
      "format": "date",
      "description": "Project creation date (YYYY-MM-DD)"
    },
    "priority": {
      "type": "string",
      "enum": ["P0-critical", "P1-high", "P2-medium", "P3-low"],
      "description": "Project priority level"
    },
    "rationale": {
      "type": "string",
      "description": "Why this project exists"
    },
    "parallel_config": {
      "type": "object",
      "description": "Configuration for parallel execution",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false,
          "description": "Whether parallel execution is enabled"
        },
        "max_concurrent": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "default": 3,
          "description": "Maximum concurrent items"
        },
        "agent_types": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Agent types that can work on this project in parallel"
        },
        "no_sequential_deps_required": {
          "type": "boolean",
          "default": false,
          "description": "If true, items without dependencies can run concurrently"
        }
      }
    },
    "worktree": {
      "type": "object",
      "description": "Worktree binding for project isolation",
      "properties": {
        "branch": {"type": "string"},
        "path": {"type": "string"},
        "required": {"type": "boolean", "default": true},
        "created_at": {"type": "string", "format": "date-time"},
        "last_activity": {"type": "string", "format": "date-time"},
        "total_merges": {"type": "integer", "default": 0},
        "merged_to_main_at": {"type": "string", "format": "date-time"}
      }
    },
    "file_ownership": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Files/directories this project owns"
    },
    "total_features": {
      "type": "integer",
      "description": "Total item count (legacy field, computed from items)"
    },
    "lessons_prompted": {
      "type": "integer",
      "description": "Number of times lesson prompt shown"
    },
    "features": {
      "type": "array",
      "description": "Legacy field - use 'items' instead. Kept for backward compatibility.",
      "items": {"$ref": "#/definitions/feature_item"}
    },
    "items": {
      "type": "array",
      "description": "Project items (features, questions, problems, etc.)",
      "items": {
        "oneOf": [
          {"$ref": "#/definitions/feature_item"},
          {"$ref": "#/definitions/research_item"},
          {"$ref": "#/definitions/planning_item"},
          {"$ref": "#/definitions/knowledge_item"},
          {"$ref": "#/definitions/investigation_item"}
        ]
      }
    }
  },
  "definitions": {
    "base_item": {
      "type": "object",
      "required": ["id"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-z]+-[0-9]{3}$",
          "description": "Unique item ID (e.g., 'core-001', 'q-001')"
        },
        "priority": {
          "type": "integer",
          "minimum": 1,
          "description": "Priority (lower = higher priority)"
        },
        "dependencies": {
          "type": "array",
          "items": {"type": "string"},
          "description": "IDs of items that must complete first"
        },
        "parallel_safe": {
          "type": "boolean",
          "default": false,
          "description": "Can this item run concurrently with others?"
        },
        "assigned_agent": {
          "type": "string",
          "description": "Agent type assigned to this item"
        },
        "started_at": {
          "type": "string",
          "format": "date-time"
        },
        "completed_at": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "feature_item": {
      "allOf": [
        {"$ref": "#/definitions/base_item"},
        {
          "type": "object",
          "required": ["description"],
          "properties": {
            "item_type": {
              "const": "feature"
            },
            "category": {
              "type": "string",
              "description": "Feature category for grouping"
            },
            "description": {
              "type": "string",
              "description": "What this feature does"
            },
            "passes": {
              "type": "boolean",
              "default": false,
              "description": "Whether feature passes (legacy field)"
            },
            "status": {
              "type": "string",
              "enum": ["pending", "in_progress", "passing", "failing"],
              "default": "pending",
              "description": "Feature status"
            },
            "steps": {
              "type": "array",
              "items": {"type": "string"},
              "description": "Implementation steps"
            },
            "acceptance_criteria": {
              "type": "array",
              "items": {"type": "string"},
              "description": "Criteria for passing"
            }
          }
        }
      ]
    },
    "research_item": {
      "allOf": [
        {"$ref": "#/definitions/base_item"},
        {
          "type": "object",
          "required": ["question"],
          "properties": {
            "item_type": {
              "const": "research"
            },
            "question": {
              "type": "string",
              "description": "Research question or hypothesis"
            },
            "hypothesis": {
              "type": "string",
              "description": "Optional hypothesis to test"
            },
            "status": {
              "type": "string",
              "enum": ["pending", "discovery", "synthesis", "verification", "completed"],
              "default": "pending",
              "description": "Research lifecycle status"
            },
            "outputs": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": {"type": "string", "enum": ["finding", "source", "synthesis", "verification"]},
                  "content": {"type": "string"},
                  "source": {"type": "string"},
                  "timestamp": {"type": "string", "format": "date-time"},
                  "confidence": {"type": "number", "minimum": 0, "maximum": 1}
                }
              },
              "description": "Research outputs and findings"
            },
            "sources": {
              "type": "array",
              "items": {"type": "string"},
              "description": "URLs or references consulted"
            }
          }
        }
      ]
    },
    "planning_item": {
      "allOf": [
        {"$ref": "#/definitions/base_item"},
        {
          "type": "object",
          "required": ["problem"],
          "properties": {
            "item_type": {
              "const": "planning"
            },
            "problem": {
              "type": "string",
              "description": "Problem statement"
            },
            "status": {
              "type": "string",
              "enum": ["problem_defined", "decomposed", "solutions_proposed", "completed"],
              "default": "problem_defined",
              "description": "Planning lifecycle status"
            },
            "sub_problems": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "id": {"type": "string"},
                  "description": {"type": "string"},
                  "status": {"type": "string", "enum": ["open", "resolved"]},
                  "resolution": {"type": "string"}
                }
              },
              "description": "Decomposed sub-problems"
            },
            "solutions": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "id": {"type": "string"},
                  "description": {"type": "string"},
                  "pros": {"type": "array", "items": {"type": "string"}},
                  "cons": {"type": "array", "items": {"type": "string"}},
                  "selected": {"type": "boolean", "default": false}
                }
              },
              "description": "Proposed solutions"
            },
            "decision": {
              "type": "string",
              "description": "Final decision made"
            }
          }
        }
      ]
    },
    "knowledge_item": {
      "allOf": [
        {"$ref": "#/definitions/base_item"},
        {
          "type": "object",
          "required": ["content", "knowledge_type"],
          "properties": {
            "item_type": {
              "const": "knowledge"
            },
            "knowledge_type": {
              "type": "string",
              "enum": ["fact", "lesson", "decision"],
              "description": "Type of knowledge"
            },
            "content": {
              "type": "string",
              "description": "The knowledge content"
            },
            "status": {
              "type": "string",
              "enum": ["proposed", "verified", "committed"],
              "default": "proposed",
              "description": "Knowledge lifecycle status"
            },
            "evidence": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": {"type": "string", "enum": ["observation", "experiment", "reference", "consensus"]},
                  "description": {"type": "string"},
                  "source": {"type": "string"},
                  "timestamp": {"type": "string", "format": "date-time"}
                }
              },
              "description": "Supporting evidence"
            },
            "committed_to": {
              "type": "string",
              "description": "Path in knowledge/ where committed"
            }
          }
        }
      ]
    },
    "investigation_item": {
      "allOf": [
        {"$ref": "#/definitions/base_item"},
        {
          "type": "object",
          "required": ["question"],
          "properties": {
            "item_type": {
              "const": "investigation"
            },
            "question": {
              "type": "string",
              "description": "Open-ended question to investigate"
            },
            "status": {
              "type": "string",
              "enum": ["open", "exploring", "concluded"],
              "default": "open",
              "description": "Investigation lifecycle status"
            },
            "findings": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "id": {"type": "string"},
                  "description": {"type": "string"},
                  "significance": {"type": "string", "enum": ["low", "medium", "high"]},
                  "timestamp": {"type": "string", "format": "date-time"},
                  "follow_up": {"type": "array", "items": {"type": "string"}}
                }
              },
              "description": "Investigation findings"
            },
            "conclusion": {
              "type": "string",
              "description": "Final conclusion when status=concluded"
            }
          }
        }
      ]
    },
    "status_lifecycles": {
      "description": "Reference for valid status transitions",
      "feature": {
        "transitions": {
          "pending": ["in_progress"],
          "in_progress": ["passing", "failing"],
          "failing": ["in_progress", "passing"],
          "passing": []
        }
      },
      "research": {
        "transitions": {
          "pending": ["discovery"],
          "discovery": ["synthesis"],
          "synthesis": ["verification"],
          "verification": ["completed", "discovery"]
        }
      },
      "planning": {
        "transitions": {
          "problem_defined": ["decomposed"],
          "decomposed": ["solutions_proposed"],
          "solutions_proposed": ["completed"]
        }
      },
      "knowledge": {
        "transitions": {
          "proposed": ["verified"],
          "verified": ["committed"]
        }
      },
      "investigation": {
        "transitions": {
          "open": ["exploring"],
          "exploring": ["concluded", "open"]
        }
      }
    }
  }
}
